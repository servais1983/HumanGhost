<!DOCTYPE html>
<html>
<head>
    <title>HumanGhost - Tableau de Bord</title>
    </head>
<body>
    <h1>üé≠ HumanGhost - Tableau de Bord</h1>
    <div class="campaign-selector">
        <label for="campaign-select">Choisir une campagne:</label>
        <select id="campaign-select">
            {% for campaign in campaigns %}
                <option value="{{ campaign.id }}">{{ campaign.name }} ({{ campaign.created_at.strftime('%Y-%m-%d %H:%M') }})</option>
            {% endfor %}
        </select>
    </div>
    <div class="log-container">
        <table>
            <thead>
                <tr><th>Heure</th><th>√âv√©nement</th><th>D√©tails</th></tr>
            </thead>
            <tbody id="log-table-body">
                </tbody>
        </table>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        const socket = io();
        const campaignSelect = document.getElementById('campaign-select');
        const tableBody = document.getElementById('log-table-body');

        // Fonction pour charger les √©v√©nements d'une campagne
        async function loadEvents(campaignId) {
            const response = await fetch(`/api/campaign/${campaignId}/events`);
            const events = await response.json();
            tableBody.innerHTML = ''; // Vide le tableau
            events.forEach(event => addEventToTable(event));
        }

        // Fonction pour ajouter une ligne au tableau
        function addEventToTable(data) {
            const newRow = document.createElement('tr');
            let detailsClass = data.type === 'credential' ? 'credential' : 'event';
            newRow.innerHTML = `
                <td>${data.timestamp}</td>
                <td class="${detailsClass}">${data.event}</td>
                <td>${data.details}</td>
            `;
            tableBody.prepend(newRow);
        }

        // Charger les √©v√©nements de la premi√®re campagne au chargement
        if (campaignSelect.value) {
            loadEvents(campaignSelect.value);
        }

        // Changer de campagne
        campaignSelect.addEventListener('change', () => {
            loadEvents(campaignSelect.value);
        });

        // Mettre √† jour en temps r√©el via Socket.IO
        socket.on('update', (data) => {
            // On ajoute l'√©v√©nement seulement si la campagne correspondante est s√©lectionn√©e
            if (campaignSelect.value == data.campaign_id) {
                 addEventToTable(data);
            }
        });
    </script>
</body>
</html>
